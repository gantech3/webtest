<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <title>HTML</title>
 </head>
 <body>
   <h1>HTML</h1>
   <p>GAS JSON load Test 4.</p>
   <script>
	const url = 'https://script.google.com/macros/s/AKfycbzylyRc4N3mqB9uX5gNpEjIsHJ_bE_Ccikpq-ZpOm1mP4AVIkvU6lfipW_wNwd1nObA/exec';
	const formData = new URLSearchParams();
	formData.append('id', 'aoki');
	formData.append('mode', 'read');
	formData.append('value', '1');

	document.write("fetch start");

	// x-www-form-urlencodedでデータを送り、テキストで取得する
	const opt2 = {
		method: 'POST',
//		mode: 'no-cors',
                headers: {
         		'Content-Type' : 'application/x-www-form-urlencoded',
                },
		// body: 'id=aoki&mode=read&value=1'
		body: formData
    	};
	fetch(url, opt2)
                .then(response => response.text())
                .then(data => {
                    document.write("text="+data+"!");
                })
                .catch(error => console.error('Error:', error));

/*	   
	// text/plain扱いでJSONデータを送受信する
    	const plainToJson = {
		method: 'POST',
                headers: {
	    		'Content-Type': 'text/plain',
		},
  		body: JSON.stringify({
   			"id": "aoki",
   			"mode": "read",
   			"value": "1"
  		})
	};
	fetch(url, plainToJson)
                .then(response => response.json())
                .then(data => {
			document.write("<p>mode="+data.mode+"!name="+data.value.name+"!</p>");
			document.write("<p>json="+(JSON.stringify(data))+"!</p>");
                })
                .catch(error => console.error('Error:', error));
*/
	</script>
 </body>
</html>
